package br.com.piracraft.lobby2.menu;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import org.bukkit.Bukkit;
import org.bukkit.Material;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.inventory.InventoryClickEvent;
import org.bukkit.inventory.Inventory;

import br.com.piracraft.api.caixas.ItemAPI;
import br.com.piracraft.api.util.MySQL;
import br.com.piracraft.lobby2.utils.Cor;
import br.com.piracraft.lobby2.utils.LobbyAPI;

public class KitPvPMenu implements Listener {

	public static Inventory menu = Bukkit.createInventory(null, 5 * 9,
			"§aKit Pvp");;
	private static Integer check(String sala) {
		PreparedStatement stm = null;
		try {
			stm = MySQL.conectar().prepareStatement(
					"SELECT * FROM V_MENU_SERVIDORES WHERE `NOMEDASALA` = ?");
			stm.setString(1, "KitPvP0" + sala);
			ResultSet rs = stm.executeQuery();
			while (rs.next()) {
				return rs.getInt("ATIVO");
			}
			rs.close();
			stm.close();
			return 0;
		} catch (SQLException e) {
			return 0;
		}
	}
	public static void updateMenu() {
		for (int i = 0; i < 10; i++) {
			menu.setItem(i, ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15,
					" ", false));
		}
		menu.setItem(17,
				ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15, " ", false));
		menu.setItem(18,
				ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15, " ", false));
		if (check("1") == 1) {
			menu.setItem(20, ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
					"§6§lSala 1", false, " ", "§7Click para conectar"));
		} else {
			menu.setItem(20, ItemAPI.Criar(Material.BARRIER, 1, 0, "§c§lSala 1",
					false, " ", "§cServidor está off-line"));
		}
		if (check("2") == 1) {
			menu.setItem(22, ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
					"§6§lSala 2", false, " ", "§7Click para conectar"));
		} else {
			menu.setItem(22, ItemAPI.Criar(Material.BARRIER, 1, 0, "§c§lSala 2",
					false, " ", "§cServidor está off-line"));
		}
		if (check("3") == 1) {
			menu.setItem(24, ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
					"§6§lSala 3", false, " ", "§7Click para conectar"));
		} else {
			menu.setItem(24, ItemAPI.Criar(Material.BARRIER, 1, 0, "§c§lSala 3",
					false, " ", "§cServidor está off-line"));
		}
		menu.setItem(26,
				ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15, " ", false));
		menu.setItem(27,
				ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15, " ", false));

		for (int i = 35; i < 45; i++) {
			menu.setItem(i, ItemAPI.Criar(Material.STAINED_GLASS_PANE, 1, 15,
					" ", false));
		}
	}

	public static void open(Player player) {
		player.openInventory(menu);
	}

	@EventHandler
	public void click(InventoryClickEvent event) {
		Player player = (Player) event.getWhoClicked();
		if (event.getInventory().getName().equalsIgnoreCase("§aKit Pvp")
				&& (event.getCurrentItem() != null)) {
			event.setCancelled(true);
			if (event.getCurrentItem()
					.isSimilar(ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
							"§6§lSala 1", false, " ",
							"§7Click para conectar"))) {
				LobbyAPI.enviarAlertaPlayer(player, "Kit Pvp",
						"Voce esta sendo enviado para kpvp01", Cor.Verde);
				LobbyAPI.enviar(player, "kpvp01");
				player.closeInventory();
			}
			if (event.getCurrentItem()
					.isSimilar(ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
							"§6§lSala 2", false, " ",
							"§7Click para conectar"))) {
				LobbyAPI.enviarAlertaPlayer(player, "Kit Pvp",
						"Voce esta sendo enviado para kpvp02", Cor.Verde);
				LobbyAPI.enviar(player, "kpvp02");

				player.closeInventory();
			}
			if (event.getCurrentItem()
					.isSimilar(ItemAPI.Criar(Material.IRON_SWORD, 1, 0,
							"§6§lSala 3", false, " ",
							"§7Click para conectar"))) {
				LobbyAPI.enviarAlertaPlayer(player, "Kit Pvp",
						"Voce esta sendo enviado para kpvp03", Cor.Verde);
				LobbyAPI.enviar(player, "kpvp03");
				player.closeInventory();
			}
		}

	}
}
