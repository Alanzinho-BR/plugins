package br.com.piracraft.lobby2;

import java.util.HashMap;

import org.bukkit.Bukkit;
import org.bukkit.command.Command;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;
import org.bukkit.plugin.Plugin;
import org.bukkit.plugin.PluginManager;
import org.bukkit.plugin.java.JavaPlugin;

import br.com.piracraft.api.util.MySQL;
import br.com.piracraft.lobby2.eventos.CancelarEventos;
import br.com.piracraft.lobby2.eventos.Entrar;
import br.com.piracraft.lobby2.listeners.GiveEffectsOnJoin;
import br.com.piracraft.lobby2.listeners.KickPlayerOnAfk;
import br.com.piracraft.lobby2.npc.InteragirNPC;
import br.com.piracraft.lobby2.npc.MySQLNPC;
import br.com.piracraft.lobby2.npc.MySQLNPC.NPC;
import br.com.piracraft.lobby2.npc.NPCs;
import br.com.piracraft.lobby2.servidores.kitpvp.ClicarKitpvp;
import br.com.piracraft.lobby2.servidores.kitpvp.MenuKitpvp;
import br.com.piracraft.lobby2.servidores.menu.ClicarMenu;
import br.com.piracraft.lobby2.servidores.menu.MenuMenu;
import br.com.piracraft.lobby2.servidores.skywars.ClicarSkyWars;
import br.com.piracraft.lobby2.servidores.skywars.MenuSkyWars;
import br.com.piracraft.lobby2.utils.RemoverChuva;
import br.com.piracraft.lobby2.utils.lobby.SetarLobby;

public class Main extends JavaPlugin
{

	private static Plugin plugin;
	private static MySQL mysql;
	public static HashMap<NPC, MySQLNPC> npc = new HashMap<>();

	@Override
	public void onEnable() {
		setPlugin(this);
//		setMysql(new MySQL("dbPiracraftServer02", "149.56.28.131", "3306", "pira010203", "root"));
		setMysql(new MySQL("", "", "", "", ""));
		registros();
		getServer().getMessenger().registerOutgoingPluginChannel(this, "BungeeCord");
		KickPlayerOnAfk afk = new KickPlayerOnAfk();
		afk.runTaskTimer(this, 20, 20);
		Bukkit.getPluginManager().registerEvents(new GiveEffectsOnJoin(), this);
		Bukkit.getPluginManager().registerEvents(afk, this);
		
	}


	@Override
	public void onDisable() {
	}

	public void registros() {
		PluginManager pm = getServer().getPluginManager();
		pm.registerEvents(new CancelarEventos(), this);
		pm.registerEvents(new Entrar(), this);
		pm.registerEvents(new ClicarSkyWars(), this);
		pm.registerEvents(new ClicarKitpvp(), this);
		pm.registerEvents(new ClicarMenu(), this);
		pm.registerEvents(new InteragirNPC(), this);
		new RemoverChuva().remover();
		new SetarLobby().setarLobby();
		new MenuSkyWars(null).setarItens();
		new MenuKitpvp(null).setarItens();
		new MenuMenu(null).setarItens();
	}
	
	@Override
	public boolean onCommand(CommandSender sender, Command cmd, String lb, String[] args) {
		if (cmd.getName().equalsIgnoreCase("npcs")){
			if (sender instanceof Player){
				Player p = (Player)sender;
				if (!p.isOp()) return true;
			}
			if (args.length == 0){
				sender.sendMessage("§cUse: §f/npcs §7<spawnar, remover>");
				return true;
			}
			if (args.length == 1){
				if (args[0].equalsIgnoreCase("spawnar")){
					NPCs.spawn();
					sender.sendMessage("§aNPCs Spawnados");
				}
				if (args[0].equalsIgnoreCase("remover")){
					NPCs.remove();
					sender.sendMessage("§aNPCs Removidos");
				}
			}
		}
		return false;
	}

	public static Plugin getPlugin() {
		return plugin;
	}

	public static void setPlugin(Plugin plugin) {
		Main.plugin = plugin;
	}

	public static MySQL getMysql() {
		return mysql;
	}

	public static void setMysql(MySQL mysql) {
		Main.mysql = mysql;
	}

}
