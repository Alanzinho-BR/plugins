package br.com.piracraft.lobby2.utils;

import java.sql.ResultSet;
import java.sql.SQLException;

import org.bukkit.Bukkit;
import org.bukkit.Location;
import org.bukkit.scheduler.BukkitRunnable;

import br.com.piracraft.api.util.MySQL;
import br.com.piracraft.lobby2.Main;
import br.com.piracraft.lobby2.npc.SpawnNPC;

/**
 * Api relacionado a coisas que nao usamos mais
 * @author Eduard-PC
 *
 */
public class FailAPI {

	public static void spawnNpcs() {
		try {
			setarNpcs();
			new BukkitRunnable() {
				@Override
				public void run() {
					LobbyAPI.removerNPCs();
					new SpawnNPC(Main.npc.get(NPC.Factions).getLocation(),
							Main.npc.get(NPC.Factions).getNome(),
							Main.npc.get(NPC.Factions).getSkin()).Spawn();
					new SpawnNPC(Main.npc.get(NPC.HardCore).getLocation(),
							Main.npc.get(NPC.HardCore).getNome(),
							Main.npc.get(NPC.HardCore).getSkin()).Spawn();
					new SpawnNPC(Main.npc.get(NPC.KitPvp).getLocation(),
							Main.npc.get(NPC.KitPvp).getNome(),
							Main.npc.get(NPC.KitPvp).getSkin()).Spawn();
					new SpawnNPC(Main.npc.get(NPC.SeteDias).getLocation(),
							Main.npc.get(NPC.SeteDias).getNome(),
							Main.npc.get(NPC.SeteDias).getSkin()).Spawn();
					new SpawnNPC(Main.npc.get(NPC.SkyWars).getLocation(),
							Main.npc.get(NPC.SkyWars).getNome(),
							Main.npc.get(NPC.SkyWars).getSkin()).Spawn();
					LobbyAPI.enviarAlertaConsole("Aviso", "Spawnando npcs.",
							Cor.Verde);

				}
			}.runTaskTimer(Main.getPlugin(), 20, 5 * 60 * 20);
		} catch (Exception e) {
			LobbyAPI.enviarAlertaConsole("ERRO", e.getMessage(), Cor.Vermelho);
		}
	}
	public static void setarNpcs() {
		try {
			Main.npc.put(NPC.Factions, new MySQLNPC(NPC.Factions));
			Main.npc.put(NPC.HardCore, new MySQLNPC(NPC.HardCore));
			Main.npc.put(NPC.KitPvp, new MySQLNPC(NPC.KitPvp));
			Main.npc.put(NPC.SeteDias, new MySQLNPC(NPC.SeteDias));
			Main.npc.put(NPC.SkyWars, new MySQLNPC(NPC.SkyWars));
		} catch (Exception e) {
			LobbyAPI.enviarAlertaConsole("ERRO", e.getMessage(), Cor.Vermelho);
		}
	}
	public static class MySQLNPC {

		private Location location;
		private String nome;
		private String skin;

		public MySQLNPC(NPC npc) {
			new BukkitRunnable() {
				@Override
				public void run() {
					try {
						ResultSet resultSet = MySQL.conectar().createStatement()
								.executeQuery(
										"SELECT * FROM `V_NPC_LOCALIZACAO` WHERE `NOMEMINIGAME` = '"
												+ String.valueOf(npc) + "'");
						if (resultSet.next()) {
							setLocation(new Location(Bukkit.getWorld("world"),
									Double.valueOf(resultSet.getString("COORDENADA")
											.split(",")[0]),
									Double.valueOf(resultSet.getString("COORDENADA")
											.split(",")[1]),
									Double.valueOf(resultSet.getString("COORDENADA")
											.split(",")[2]),
									Float.valueOf(resultSet.getString("COORDENADA")
											.split(",")[3]),
									Float.valueOf(resultSet.getString("COORDENADA")
											.split(",")[4])));
							setNome(resultSet.getString("NOME"));
							setSkin(resultSet.getString("SKIN"));
						}
						resultSet.getStatement().getConnection().close();

					} catch (SQLException e) {
						LobbyAPI.enviarAlertaConsole("Mysq", e.getMessage(),
								Cor.Vermelho);
					}
				}
			}.runTaskAsynchronously(Main.getPlugin());
		}

	
		public Location getLocation() {
			return location;
		}

		public void setLocation(Location location) {
			this.location = location;
		}

		public String getNome() {
			return nome;
		}

		public void setNome(String nome) {
			this.nome = nome;
		}

		public String getSkin() {
			return skin;
		}

		public void setSkin(String skin) {
			this.skin = skin;
		}

	}
	public static enum NPC {
		SkyWars, Factions, KitPvp, HardCore, SeteDias;
	}

}
