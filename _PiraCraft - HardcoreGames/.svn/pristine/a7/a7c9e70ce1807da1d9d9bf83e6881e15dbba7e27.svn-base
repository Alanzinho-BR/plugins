package me.douglasamv.hg.Comandos;

import org.bukkit.Bukkit;
import org.bukkit.GameMode;
import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.PlayerJoinEvent;

import me.douglasamv.hg.Main;
import me.douglasamv.hg.Eventos.ChecarVitoria;
import me.douglasamv.hg.Manager.EspectadoresManager;
import me.douglasamv.hg.Manager.Habilidade;
import me.douglasamv.hg.api.ItemAPI;

public class CMDWatch implements Listener, CommandExecutor {

	@EventHandler
	void entrar(PlayerJoinEvent e) {
		Player p = e.getPlayer();
		for (String p2 : Main.Watch) {
			if (p2 != null) {
				p.hidePlayer(Bukkit.getPlayer(p2));
			}

		}
	}
	
	public static void setarWatch(Player p) {
		p.setAllowFlight(true);
		p.sendMessage("§aVoce entrou no modo espectador");
		p.getInventory().clear();
		p.setGameMode(GameMode.CREATIVE);

		p.getInventory().setItem(0, ItemAPI.Head("§aMenu De Transporte §7(Click)", p.getName()));

		Main.Watch.add(p.getName());
		EspectadoresManager.DamageMobs.add(p);
		Main.Jogadores.remove(p.getName());
		p.getInventory().setArmorContents(null);
		p.updateInventory();
		p.spigot().setCollidesWithEntities(false);
		ChecarVitoria.verificaWin();
		Habilidade.removeAbility(p);
		for (Player pl : Bukkit.getOnlinePlayers()) {
			pl.hidePlayer(p);
		}
	}

	public boolean onCommand(CommandSender sender, Command cmd, String label, String[] args) {
		if (!(sender instanceof Player)) {
			sender.sendMessage("§cComando de Jogador!");
			return true;
		}
		Player p = (Player) sender;
		if (cmd.getName().equalsIgnoreCase("watch") && (p.hasPermission("hg.cmd.watch"))) {
			setarWatch(p);
		} else {
			p.sendMessage("§cSem permissao!");
		}
		return true;
	}
}