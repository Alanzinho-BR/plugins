package me.douglasamv.hg.Timer;

import org.bukkit.Bukkit;
import org.bukkit.Difficulty;
import org.bukkit.Sound;
import org.bukkit.World;
import org.bukkit.entity.Player;

import me.douglasamv.hg.Main;
import me.douglasamv.hg.Eventos.ChecarVitoria;
import me.douglasamv.hg.api.ScoreBoardBolada;

public class Invencibilidade {

	private static Integer shed_id;

	public Invencibilidade() {
		shed_id = Integer
				.valueOf(Bukkit.getServer().getScheduler().scheduleSyncRepeatingTask(Main.instance, new Runnable() {
					public void run() {
						if (Main.TimerInvencibilidade > 0) {
							if (((Main.TimerInvencibilidade >= 10 ? 1 : 0)
									& (Main.TimerInvencibilidade % 10 == 0 ? 1 : 0)) != 0) {
								if ((Main.PreInvencibilidade) && (Main.TimerInvencibilidade == 60)) {
									((World) Bukkit.getServer().getWorlds().get(0)).setDifficulty(Difficulty.PEACEFUL);
									Bukkit.broadcastMessage("§eA Invencibilidade acaba em 1 Minuto!");
								}
								if ((Main.PreInvencibilidade) && (Main.TimerInvencibilidade == 30)) {
									Bukkit.broadcastMessage("§eA Invencibilidade acaba em 30 Segundos!");
								}
								if ((Main.PreInvencibilidade) && (Main.TimerInvencibilidade == 10)) {
									Bukkit.broadcastMessage("§eA Invencibilidade acaba em 10 Segundos!");
								}
							} else if ((Main.PreInvencibilidade) && (Main.TimerInvencibilidade < 6)) {
								Bukkit.broadcastMessage(
										"§eA Invencibilidade acaba em " + Main.TimerInvencibilidade + "s");
								for (Player pl : Bukkit.getOnlinePlayers()) {
									pl.playSound(pl.getLocation(), Sound.CLICK, 1.0F, 1.0F);
								}
							}
							Main.TimerInvencibilidade--;
							if (Main.PreInvencibilidade) {
								for (Player p : Bukkit.getOnlinePlayers()) {
									if (!ScoreBoardBolada.score.contains(p.getName())) {
										ScoreBoardBolada.scoreBoard(p);
									}
								}
							}
						} else {
							Andamento.Iniciar(120);
							Invencibilidade.cancel();
							Bukkit.broadcastMessage("§eInvencibilidade Acabou!");

							Bukkit.getServer().getWorld("world").setDifficulty(Difficulty.HARD);
							Main.PreInvencibilidade = false;
							Main.Partida = true;
							ChecarVitoria.verificaWin();
							for (Player pl : Bukkit.getOnlinePlayers()) {
								pl.playSound(pl.getLocation(), Sound.ANVIL_LAND, 30.0F, 30.0F);
								ScoreBoardBolada.removeScore(pl);
							}
							if (Main.Partida) {
								new Andamento();
								cancel();
							}
						}
					}
				}, 0L, 20L));
	}

	public static void cancel() {
		if (shed_id != null) {
			Bukkit.getServer().getScheduler().cancelTask(shed_id);
			shed_id = null;
		}
	}
}